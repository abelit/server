include/master-slave.inc
[connection master]
connection slave;
include/stop_slave.inc
connection master;
call mtr.add_suppression("Found 1 prepared XA transactions");
CREATE TABLE t1 (a INT) ENGINE=innodb;
XA START 'xid_partly_rolled_back';
INSERT INTO t1 VALUES(1);
XA END 'xid_partly_rolled_back';
XA PREPARE 'xid_partly_rolled_back';
SET @@session.debug="+d,crash_after_xa_rollback";
Warnings:
Warning	1287	'@@debug' is deprecated and will be removed in a future release. Please use '@@debug_dbug' instead
XA ROLLBACK 'xid_partly_rolled_back';
ERROR HY000: Lost connection to MySQL server during query
include/rpl_start_server.inc [server_number=1]
connection master;
include/assert.inc [Zero records in t1 is expected at master]
include/show_binlog_events.inc
Log_name	Pos	Event_type	Server_id	End_log_pos	Info
master-bin.000001	#	Gtid	#	#	BEGIN GTID #-#-#
master-bin.000001	#	Query	#	#	use `mtr`; INSERT INTO test_suppressions (pattern) VALUES ( NAME_CONST('pattern',_latin1'Found 1 prepared XA transactions' COLLATE 'latin1_swedish_ci'))
master-bin.000001	#	Query	#	#	COMMIT
master-bin.000001	#	Gtid	#	#	GTID #-#-#
master-bin.000001	#	Query	#	#	use `test`; CREATE TABLE t1 (a INT) ENGINE=innodb
master-bin.000001	#	Gtid	#	#	XA START X'7869645f706172746c795f726f6c6c65645f6261636b',X'',1 GTID #-#-#
master-bin.000001	#	Query	#	#	use `test`; INSERT INTO t1 VALUES(1)
master-bin.000001	#	Query	#	#	XA END X'7869645f706172746c795f726f6c6c65645f6261636b',X'',1
master-bin.000001	#	XA_prepare	#	#	XA PREPARE X'7869645f706172746c795f726f6c6c65645f6261636b',X'',1
master-bin.000001	#	Gtid	#	#	GTID #-#-#
master-bin.000001	#	Query	#	#	XA ROLLBACK X'7869645f706172746c795f726f6c6c65645f6261636b',X'',1
SET @save.sql_log_bin = @@session.sql_log_bin;
SET @@session.sql_log_bin = 0;
XA ROLLBACK 'xid_partly_rolled_back';
SET @@session.sql_log_bin = @save.sql_log_bin;
connection slave;
include/start_slave.inc
connection master;
include/sync_slave_sql_with_master.inc
include/assert.inc [Zero records in t1 is expected at slave]
connection master;
DROP TABLE t1;
include/sync_slave_sql_with_master.inc
include/rpl_end.inc
